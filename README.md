# Compilers-Construction

Компилятор объектно-ориентированного языка программирования с генерацией исполняемых файлов через IL (Intermediate Language).

## Архитектура

Компилятор состоит из следующих компонентов:

### 1. Лексер (Compiler.Lexer)
Преобразует исходный текст в последовательность токенов.

**Поддерживаемые токены:**
- Ключевые слова: `class`, `is`, `var`, `method`, `return`, `end`, `this`, `extends`, `while`, `loop`, `if`, `then`, `else`, `true`, `false`
- Литералы: целые числа, вещественные числа, строки, булевы значения
- Операторы: `:=` (присваивание), `=>` (лямбда), `:`, `,`, `.`, `()`, `[]`
- Комментарии: `//` до конца строки

### 2. Парсер (Compiler.Parser)
Строит абстрактное синтаксическое дерево (AST) из токенов.

**Поддерживаемые конструкции:**
- Классы с наследованием
- Поля класса с инициализацией
- Методы с параметрами и возвращаемым типом
- Конструкторы
- Локальные переменные
- Условные операторы (`if-then-else`)
- Циклы (`while-loop`)
- Вызовы методов и конструкторов
- Доступ к полям и индексация

### 3. Семантический анализатор (SemanticAnalyzer)
Проверяет корректность программы:
- Дублирование имен классов, полей, методов
- Существование типов и базовых классов
- Циклы в наследовании
- Совместимость типов при присваивании
- Существование вызываемых методов и полей

### 4. Оптимизатор (AstOptimizer)
Выполняет оптимизации на уровне AST:
- Удаление недостижимого кода после `return`
- Вычисление константных условий (`if true`, `if false`, `while false`)
- Удаление неиспользуемых переменных без инициализаторов

### 5. Генератор IL (IlGenerator)
Генерирует IL-код и создает исполняемый файл через `ilasm`:
- Преобразование классов в IL-типы
- Генерация конструкторов и методов
- Поддержка примитивных типов (Integer, Real, Boolean, String)
- Динамическая точка входа с выбором класса через аргументы командной строки

## Использование

```bash
# Лексический анализ
dotnet run --project src/Compiler.Cli -- --lex <file.o>

# Синтаксический анализ
dotnet run --project src/Compiler.Cli -- --parse <file.o>

# Семантический анализ
dotnet run --project src/Compiler.Cli -- --analyze <file.o>

# Оптимизация
dotnet run --project src/Compiler.Cli -- --optimize <file.o>

# Компиляция в исполняемый файл
dotnet run --project src/Compiler.Cli -- --compile <file.o> <output.exe> [ilasm-path]
```

## Запуск скомпилированной программы

```bash
# Запуск класса Main (по умолчанию)
./output.exe

# Запуск конкретного класса с аргументами
./output.exe ClassName arg1 arg2 ...
```

Компилятор автоматически парсит аргументы в соответствии с типами параметров конструктора.

## Пример программы

```
class Point is
    var x : Integer
    var y : Integer
    
    this(px : Integer, py : Integer) is
        x := px
        y := py
    end
    
    method Print is
        x.Print()
        y.Print()
    end
end

class Main is
    this is
        var p : Point(10, 20)
        p.Print()
    end
end
```

## Требования

- .NET 8.0 SDK
- ilasm (входит в состав .NET SDK или Mono)
